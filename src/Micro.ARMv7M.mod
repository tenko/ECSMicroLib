MODULE ARMv7M IN Micro;

	(*
		Alexander Shiryaev, 2014.09, 2017.03
        Modified by Tenko for use with ECS

		ARMv7-M Architecture Reference Manual
			https://developer.arm.com/documentation/ddi0403/latest/
	*)

	IMPORT SYSTEM;

    TYPE ADDRESS = SYSTEM.ADDRESS;
    
	CONST
	    (* Debug *)
            SCB_DEMCR* = ADDRESS(0E000EDFCH);   (* Debug Exception and Monitor Control Register *)
            DWT_CYCCNT* = ADDRESS(0E0001004H);  (* DWT Cycle Count register *)
            DWT_CONTROL* = ADDRESS(0E0001000H); (* DWT control register*)
	    
		(* B1.5.2: exception numbers *)
			Reset* = 1;
			NMI* = 2;
			HardFault* = 3;
			MemManage* = 4;
			BusFault* = 5;
			UsageFault* = 6;
			SVCall* = 11;
			DebugMonitor* = 12;
			PendSV* = 14;
			SysTick* = 15;
			ExternalInterrupt0* = 16;

		(* B3.2.2 *)
			(* SCB registers *)
				CPUID*  = ADDRESS(0E000ED00H); (* CPUID Base Register *)
				ICSR*   = ADDRESS(0E000ED04H); (* Interrupt Control and State Register *)
				VTOR*   = ADDRESS(0E000ED08H); (* Vector Table Offset Register *)
				AIRCR*  = ADDRESS(0E000ED0CH); (* Application Interrupt and Reset Control Register *)
				SCR*    = ADDRESS(0E000ED10H); (* System Control Register *)
				CCR*    = ADDRESS(0E000ED14H); (* Configuration and Control Register *)
				SHPR1*  = ADDRESS(0E000ED18H); (* System Handler Priority Register 1 *)
				SHPR2*  = ADDRESS(0E000ED1CH); (* System Handler Priority Register 2 *)
				SHPR3*  = ADDRESS(0E000ED20H); (* System Handler Priority Register 3 *)
				SHCSR*  = ADDRESS(0E000ED24H); (* System Handler Control and State Register *)
				CFSR*   = ADDRESS(0E000ED28H); (* Configurable Fault Status Register *)
				UFSR* 	= ADDRESS(0E000ED2AH); (* UsageFault Status Register *)
				HFSR*   = ADDRESS(0E000ED2CH); (* HardFault Status Register *)
				DFSR*   = ADDRESS(0E000ED30H); (* Debug Fault Status Register *)
				MMFAR*  = ADDRESS(0E000ED34H); (* MemManage Fault Address Register *)
				BFAR*   = ADDRESS(0E000ED38H); (* BusFault Address Register *)
				AFSR*   = ADDRESS(0E000ED3CH); (* Auxiliary Fault Status Register *)
				CPACR*  = ADDRESS(0E000ED88H); (* Coprocessor Access Control Register *)

			(* Additional SCB registers for the FP extension *)			
				FPCCR*  = ADDRESS(0E000EF34H); (* Floating-Point Context Control Register *)
				FPCAR*  = ADDRESS(0E000EF38H); (* Floating-Point Context Address Register *)
				FPDSCR* = ADDRESS(0E000EF3CH); (* Floating-Point Default Status Control Register *)
				MVFR0*  = ADDRESS(0E000EF40H); (* Media and FP Feature Register 0 *)
				MVFR1*  = ADDRESS(0E000EF44H); (* Media and FP Feature Register 1 *)

			(* System control and ID registers not in the SCB *)
				ICTR*   = ADDRESS(0E000E004H); (* Interrupt Controller Type Register *)
				ACTLR*  = ADDRESS(0E000E008H); (* Auxiliary Control Register *)
				STIR*   = ADDRESS(0E000EF00H); (* Software Triggered Interrupt Register *)
				(* Peripherial Identification Registers *)
					PID4* = ADDRESS(0E000EFD0H);
					PID5* = ADDRESS(0E000EFD4H);
					PID6* = ADDRESS(0E000EFD8H);
					PID7* = ADDRESS(0E000EFDCH);
					PID0* = ADDRESS(0E000EFE0H);
					PID1* = ADDRESS(0E000EFE4H);
					PID2* = ADDRESS(0E000EFE8H);
					PID3* = ADDRESS(0E000EFECH);
				(* Component Identification Registers *)
					CID0* = ADDRESS(0E000EFF0H);
					CID1* = ADDRESS(0E000EFF4H);
					CID2* = ADDRESS(0E000EFF5H);
					CID3* = ADDRESS(0E000EFFCH);

		(* B3.3.2 *)
			(* SysTick registers *)
				SYSTCSR*    = ADDRESS(0E000E010H); (* SysTick Control and Status Register *)
				SYSTRVR*    = ADDRESS(0E000E014H); (* SysTick Reload Value Register *)
				SYSTCVR*    = ADDRESS(0E000E018H); (* SysTick Current Value Register *)
				SYSTCALIB*  = ADDRESS(0E000E01CH); (* SysTick Calibration Value Register *)

		(* B3.4: Nested Vectored Interrupt Controller, NVIC *)
			(* Interrupt Set-Enable Registers *)
				NVICISER0*  = ADDRESS(0E000E100H);
				NVICISER1*  = ADDRESS(0E000E104H);
				NVICISER2*  = ADDRESS(0E000E108H);
				NVICISER3*  = ADDRESS(0E000E10CH);
				NVICISER4*  = ADDRESS(0E000E110H);
				NVICISER5*  = ADDRESS(0E000E114H);
				NVICISER6*  = ADDRESS(0E000E118H);
				NVICISER7*  = ADDRESS(0E000E11CH);
				NVICISER8*  = ADDRESS(0E000E120H);
				NVICISER9*  = ADDRESS(0E000E124H);
				NVICISER10* = ADDRESS(0E000E128H);
				NVICISER11* = ADDRESS(0E000E12CH);
				NVICISER12* = ADDRESS(0E000E130H);
				NVICISER13* = ADDRESS(0E000E134H);
				NVICISER14* = ADDRESS(0E000E138H);
				NVICISER15* = ADDRESS(0E000E13CH);
			(* Interrupt Clear-Enable Registers *)
				NVICICER0*  = ADDRESS(0E000E180H);
				NVICICER1*  = ADDRESS(0E000E184H);
				NVICICER2*  = ADDRESS(0E000E188H);
				NVICICER3*  = ADDRESS(0E000E18CH);
				NVICICER4*  = ADDRESS(0E000E190H);
				NVICICER5*  = ADDRESS(0E000E194H);
				NVICICER6*  = ADDRESS(0E000E198H);
				NVICICER7*  = ADDRESS(0E000E19CH);
				NVICICER8*  = ADDRESS(0E000E1A0H);
				NVICICER9*  = ADDRESS(0E000E1A4H);
				NVICICER10* = ADDRESS(0E000E1A8H);
				NVICICER11* = ADDRESS(0E000E1ACH);
				NVICICER12* = ADDRESS(0E000E1B0H);
				NVICICER13* = ADDRESS(0E000E1B4H);
				NVICICER14* = ADDRESS(0E000E1B8H);
				NVICICER15* = ADDRESS(0E000E1BCH);
			(* Interrupt Set-Pending Registers *)
				NVICISPR0*  = ADDRESS(0E000E200H);
				NVICISPR1*  = ADDRESS(0E000E204H);
				NVICISPR2*  = ADDRESS(0E000E208H);
				NVICISPR3*  = ADDRESS(0E000E20CH);
				NVICISPR4*  = ADDRESS(0E000E210H);
				NVICISPR5*  = ADDRESS(0E000E214H);
				NVICISPR6*  = ADDRESS(0E000E218H);
				NVICISPR7*  = ADDRESS(0E000E21CH);
				NVICISPR8*  = ADDRESS(0E000E220H);
				NVICISPR9*  = ADDRESS(0E000E224H);
				NVICISPR10* = ADDRESS(0E000E228H);
				NVICISPR11* = ADDRESS(0E000E22CH);
				NVICISPR12* = ADDRESS(0E000E230H);
				NVICISPR13* = ADDRESS(0E000E234H);
				NVICISPR14* = ADDRESS(0E000E238H);
				NVICISPR15* = ADDRESS(0E000E23CH);
			(* Interrupt Clear-Pending Registers *)
				NVICICPR0*  = ADDRESS(0E000E280H);
				NVICICPR1*  = ADDRESS(0E000E284H);
				NVICICPR2*  = ADDRESS(0E000E288H);
				NVICICPR3*  = ADDRESS(0E000E28CH);
				NVICICPR4*  = ADDRESS(0E000E290H);
				NVICICPR5*  = ADDRESS(0E000E294H);
				NVICICPR6*  = ADDRESS(0E000E298H);
				NVICICPR7*  = ADDRESS(0E000E29CH);
				NVICICPR8*  = ADDRESS(0E000E2A0H);
				NVICICPR9*  = ADDRESS(0E000E2A4H);
				NVICICPR10* = ADDRESS(0E000E2A8H);
				NVICICPR11* = ADDRESS(0E000E2ACH);
				NVICICPR12* = ADDRESS(0E000E2B0H);
				NVICICPR13* = ADDRESS(0E000E2B4H);
				NVICICPR14* = ADDRESS(0E000E2B8H);
				NVICICPR15* = ADDRESS(0E000E2BCH);
			(* Interrupt Active Bit Registers *)
				NVICIABR0* = ADDRESS(0E000E300H);
				NVICIABR1* = ADDRESS(0E000E304H);
				NVICIABR2* = ADDRESS(0E000E308H);
				NVICIABR3* = ADDRESS(0E000E30CH);
				NVICIABR4* = ADDRESS(0E000E310H);
				NVICIABR5* = ADDRESS(0E000E314H);
				NVICIABR6* = ADDRESS(0E000E318H);
				NVICIABR7* = ADDRESS(0E000E31CH);
				(*
				NVICIABR8*  = ADDRESS(0E000E320H);
				NVICIABR9*  = ADDRESS(0E000E324H);
				NVICIABR10* = ADDRESS(0E000E328H);
				NVICIABR11* = ADDRESS(0E000E32CH);
				NVICIABR12* = ADDRESS(0E000E330H);
				NVICIABR13* = ADDRESS(0E000E334H);
				NVICIABR14* = ADDRESS(0E000E338H);
				NVICIABR15* = ADDRESS(0E000E33CH);
				*)
			(* Interrupt Priority Registers *)
				NVICIPR0*   = ADDRESS(0E000E400H);
				NVICIPR1*   = ADDRESS(0E000E404H);
				NVICIPR2*   = ADDRESS(0E000E408H);
				NVICIPR3*   = ADDRESS(0E000E40CH);
				NVICIPR4*   = ADDRESS(0E000E410H);
				NVICIPR5*   = ADDRESS(0E000E414H);
				NVICIPR6*   = ADDRESS(0E000E418H);
				NVICIPR7*   = ADDRESS(0E000E41CH);
				NVICIPR8*   = ADDRESS(0E000E420H);
				NVICIPR9*   = ADDRESS(0E000E424H);
				NVICIPR10*  = ADDRESS(0E000E428H);
				NVICIPR11*  = ADDRESS(0E000E42CH);
				NVICIPR12*  = ADDRESS(0E000E430H);
				NVICIPR13*  = ADDRESS(0E000E434H);
				NVICIPR14*  = ADDRESS(0E000E438H);
				NVICIPR15*  = ADDRESS(0E000E43CH);
				NVICIPR16*  = ADDRESS(0E000E440H);
				NVICIPR17*  = ADDRESS(0E000E444H);
				NVICIPR18*  = ADDRESS(0E000E448H);
				NVICIPR19*  = ADDRESS(0E000E44CH);
				NVICIPR20*  = ADDRESS(0E000E450H);
				NVICIPR21*  = ADDRESS(0E000E454H);
				NVICIPR22*  = ADDRESS(0E000E458H);
				NVICIPR23*  = ADDRESS(0E000E45CH);
				NVICIPR24*  = ADDRESS(0E000E460H);
				NVICIPR25*  = ADDRESS(0E000E464H);
				NVICIPR26*  = ADDRESS(0E000E468H);
				NVICIPR27*  = ADDRESS(0E000E46CH);
				NVICIPR28*  = ADDRESS(0E000E470H);
				NVICIPR29*  = ADDRESS(0E000E474H);
				NVICIPR30*  = ADDRESS(0E000E478H);
				NVICIPR31*  = ADDRESS(0E000E47CH);
				NVICIPR32*  = ADDRESS(0E000E480H);
				NVICIPR33*  = ADDRESS(0E000E484H);
				NVICIPR34*  = ADDRESS(0E000E488H);
				NVICIPR35*  = ADDRESS(0E000E48CH);
				NVICIPR36*  = ADDRESS(0E000E490H);
				NVICIPR37*  = ADDRESS(0E000E494H);
				NVICIPR38*  = ADDRESS(0E000E498H);
				NVICIPR39*  = ADDRESS(0E000E49CH);
				NVICIPR40*  = ADDRESS(0E000E4A0H);
				NVICIPR41*  = ADDRESS(0E000E4A4H);
				NVICIPR42*  = ADDRESS(0E000E4A8H);
				NVICIPR43*  = ADDRESS(0E000E4ACH);
				NVICIPR44*  = ADDRESS(0E000E4B0H);
				NVICIPR45*  = ADDRESS(0E000E4B4H);
				NVICIPR46*  = ADDRESS(0E000E4B8H);
				NVICIPR47*  = ADDRESS(0E000E4BCH);
				NVICIPR48*  = ADDRESS(0E000E4C0H);
				NVICIPR49*  = ADDRESS(0E000E4C4H);
				NVICIPR50*  = ADDRESS(0E000E4C8H);
				NVICIPR51*  = ADDRESS(0E000E4CCH);
				NVICIPR52*  = ADDRESS(0E000E4D0H);
				NVICIPR53*  = ADDRESS(0E000E4D4H);
				NVICIPR54*  = ADDRESS(0E000E4D8H);
				NVICIPR55*  = ADDRESS(0E000E4DCH);
				NVICIPR56*  = ADDRESS(0E000E4E0H);
				NVICIPR57*  = ADDRESS(0E000E4E4H);
				NVICIPR58*  = ADDRESS(0E000E4E8H);
				NVICIPR59*  = ADDRESS(0E000E4ECH);
				(*
				NVICIPR60*  = ADDRESS(0E000E4F0H);
				NVICIPR61*  = ADDRESS(0E000E4F4H);
				NVICIPR62*  = ADDRESS(0E000E4F8H);
				NVICIPR63*  = ADDRESS(0E000E4FCH);
				NVICIPR64*  = ADDRESS(0E000E500H);
				NVICIPR65*  = ADDRESS(0E000E504H);
				NVICIPR66*  = ADDRESS(0E000E508H);
				NVICIPR67*  = ADDRESS(0E000E50CH);
				NVICIPR68*  = ADDRESS(0E000E510H);
				NVICIPR69*  = ADDRESS(0E000E514H);
				NVICIPR70*  = ADDRESS(0E000E518H);
				NVICIPR71*  = ADDRESS(0E000E51CH);
				NVICIPR72*  = ADDRESS(0E000E520H);
				NVICIPR73*  = ADDRESS(0E000E524H);
				NVICIPR74*  = ADDRESS(0E000E528H);
				NVICIPR75*  = ADDRESS(0E000E52CH);
				NVICIPR76*  = ADDRESS(0E000E530H);
				NVICIPR77*  = ADDRESS(0E000E534H);
				NVICIPR78*  = ADDRESS(0E000E538H);
				NVICIPR79*  = ADDRESS(0E000E53CH);
				NVICIPR80*  = ADDRESS(0E000E540H);
				NVICIPR81*  = ADDRESS(0E000E544H);
				NVICIPR82*  = ADDRESS(0E000E548H);
				NVICIPR83*  = ADDRESS(0E000E54CH);
				NVICIPR84*  = ADDRESS(0E000E550H);
				NVICIPR85*  = ADDRESS(0E000E554H);
				NVICIPR86*  = ADDRESS(0E000E558H);
				NVICIPR87*  = ADDRESS(0E000E55CH);
				NVICIPR88*  = ADDRESS(0E000E560H);
				NVICIPR89*  = ADDRESS(0E000E564H);
				NVICIPR90*  = ADDRESS(0E000E568H);
				NVICIPR91*  = ADDRESS(0E000E56CH);
				NVICIPR92*  = ADDRESS(0E000E570H);
				NVICIPR93*  = ADDRESS(0E000E574H);
				NVICIPR94*  = ADDRESS(0E000E578H);
				NVICIPR95*  = ADDRESS(0E000E57CH);
				NVICIPR96*  = ADDRESS(0E000E580H);
				NVICIPR97*  = ADDRESS(0E000E584H);
				NVICIPR98*  = ADDRESS(0E000E588H);
				NVICIPR99*  = ADDRESS(0E000E58CH);
				NVICIPR100* = ADDRESS(0E000E590H);
				NVICIPR101* = ADDRESS(0E000E594H);
				NVICIPR102* = ADDRESS(0E000E598H);
				NVICIPR103* = ADDRESS(0E000E59CH);
				NVICIPR104* = ADDRESS(0E000E5A0H);
				NVICIPR105* = ADDRESS(0E000E5A4H);
				NVICIPR106* = ADDRESS(0E000E5A8H);
				NVICIPR107* = ADDRESS(0E000E5ACH);
				NVICIPR108* = ADDRESS(0E000E5B0H);
				NVICIPR109* = ADDRESS(0E000E5B4H);
				NVICIPR110* = ADDRESS(0E000E5B8H);
				NVICIPR111* = ADDRESS(0E000E5BCH);
				NVICIPR112* = ADDRESS(0E000E5C0H);
				NVICIPR113* = ADDRESS(0E000E5C4H);
				NVICIPR114* = ADDRESS(0E000E5C8H);
				NVICIPR115* = ADDRESS(0E000E5CCH);
				NVICIPR116* = ADDRESS(0E000E5D0H);
				NVICIPR117* = ADDRESS(0E000E5D4H);
				NVICIPR118* = ADDRESS(0E000E5D8H);
				NVICIPR119* = ADDRESS(0E000E5DCH);
				NVICIPR120* = ADDRESS(0E000E5E0H);
				NVICIPR121* = ADDRESS(0E000E5E4H);
				NVICIPR122* = ADDRESS(0E000E5E8H);
				NVICIPR123* = ADDRESS(0E000E5ECH);
				*)

		(* B4.1.2 *)
			(* Processor Feature ID register support in SCS *)
				IDPFR0*     = ADDRESS(0E000ED40H); (* Processor Feature Register 0 *)
				IDPFR1*     = ADDRESS(0E000ED44H); (* Processor Feature Register 1 *)
				IDDFR0*     = ADDRESS(0E000ED48H); (* Debug Feature Register 0 *)
				IDAFR0*     = ADDRESS(0E000ED4CH); (* Auxiliary Feature Register 0 *)
				IDMMFR0*    = ADDRESS(0E000ED50H); (* Memory Model Feature Register 0 *)
				IDMMFR1*    = ADDRESS(0E000ED54H); (* Memory Model Feature Register 1 *)
				IDMMFR2*    = ADDRESS(0E000ED58H); (* Memory Model Feature Register 2 *)
				IDMMFR3*    = ADDRESS(0E000ED5CH); (* Memory Model Feature Register 3 *)
				IDISAR0*    = ADDRESS(0E000ED60H); (* Instruction Set Attribute Register 0 *)
				IDISAR1*    = ADDRESS(0E000ED64H); (* Instruction Set Attribute Register 1 *)
				IDISAR2*    = ADDRESS(0E000ED68H); (* Instruction Set Attribute Register 2 *)
				IDISAR3*    = ADDRESS(0E000ED6CH); (* Instruction Set Attribute Register 3 *)
				IDISAR4*    = ADDRESS(0E000ED70H); (* Instruction Set Attribute Register 4 *)
				IDISAR5*    = ADDRESS(0E000ED74H);

    PROCEDURE WFI*();
    BEGIN SYSTEM.ASM("wfi")
    END WFI;

    PROCEDURE DMB*();
    BEGIN SYSTEM.ASM("dmb")
    END DMB;

    PROCEDURE DSB*();
    BEGIN SYSTEM.ASM("dsb")
    END DSB;

    PROCEDURE ISB*();
    BEGIN SYSTEM.ASM("isb")
    END ISB;

    PROCEDURE CPSIEi*();
    BEGIN SYSTEM.ASM("cpsie i")
    END CPSIEi;

    PROCEDURE CPSIDi*();
    BEGIN SYSTEM.ASM("cpsid i")
    END CPSIDi;

    PROCEDURE CPSIEf*();
    BEGIN SYSTEM.ASM("cpsie f")
    END CPSIEf;

    PROCEDURE CPSIDf*();
    BEGIN SYSTEM.ASM("cpsid f")
    END CPSIDf;

    PROCEDURE CPSIEif*();
    BEGIN SYSTEM.ASM("cpsie if")
    END CPSIEif;

    PROCEDURE CPSIDif*();
    BEGIN SYSTEM.ASM("cpsid if")
    END CPSIDif;

END ARMv7M.
